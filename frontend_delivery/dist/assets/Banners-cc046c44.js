import{_ as L,b as l,d as M,s as ne,U as h,j as N,r as E,o as v,c as m,v as j,w as k,q as A,e as n,F as P,k as T,i as V,x as re,y as z,z as O,f as S,a as d,g as oe,n as le,A as F}from"./index-147646d1.js";import{f as se}from"./fetchService-d0f0c0ab.js";import{p as ie}from"./ProductService-17bec8c6.js";import"./reportes-522cfb98.js";const X=p=>(z("data-v-5afaeec9"),p=p(),O(),p),ce={class:"container",style:{"background-color":"red","min-width":"100%"}},ue=X(()=>n("i",{class:"pi pi-angle-left"},null,-1)),de=["src","alt"],ve=X(()=>n("i",{class:"pi pi-angle-right"},null,-1)),pe=3e3,fe={__name:"Banner",setup(p){const a=l([]),s=l(0);let c=null;M(async()=>{await y(),_()}),ne(()=>{b()});async function y(){try{const g=await se.get(`${h}/banners`);a.value=g.sort((w,I)=>w.index-I.index),s.value=0}catch(g){console.error("Error al cargar banners:",g)}}function _(){!c&&a.value.length>1&&(c=setInterval(()=>{x()},pe))}function b(){c&&(clearInterval(c),c=null)}function x(){a.value.length!==0&&(s.value=(s.value+1)%a.value.length)}function f(){a.value.length!==0&&(s.value=(s.value-1+a.value.length)%a.value.length)}const D=N(()=>`transform: translateX(${-s.value*100}%); transition: all 0.3s ease;`);return(g,w)=>{const I=E("Button");return v(),m("div",ce,[a.value.length>1?(v(),j(I,{key:0,class:"button-left",onClick:f},{default:k(()=>[ue]),_:1})):A("",!0),n("div",{class:"slider",style:re(D.value)},[(v(!0),m(P,null,T(a.value,(B,$)=>(v(),m("img",{key:B.id??$,src:`${V(h)}/read-photo-product/${B.img_identifier}`,alt:B.title??`Banner ${$}`},null,8,de))),128))],4),a.value.length>1?(v(),j(I,{key:1,class:"button-right",onClick:x},{default:k(()=>[ve]),_:1})):A("",!0)])}}},ge=L(fe,[["__scopeId","data-v-5afaeec9"]]);const q=p=>(z("data-v-e24c84a5"),p=p(),O(),p),me={style:{padding:"3rem"}},_e=q(()=>n("h2",null,[n("b",null,"Arrastra y Reordena las Imágenes")],-1)),he={class:"image",style:{display:"flex","flex-direction":"column",position:"relative","justify-content":"end","align-items":"end"}},ye=["src"],be={key:1,style:{position:"absolute",left:"0",top:"0",width:"100%",display:"flex","justify-content":"center","align-items":"center",height:"100%","background-color":"#ffffff80"}},xe={class:"col-12 px-0 pb-0"},De={class:"draggable-container"},Ie=["onDragstart","onDragenter","onDrop"],ke=["src","alt"],we=q(()=>n("div",{class:"confirmation-content"},[n("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"#ff9800"}}),n("span",{class:"message"},"¿Estás seguro de que deseas eliminar esta imagen?")],-1)),Be={class:"dialog-footer"},$e={__name:"Banners",setup(p){const a=l([]),s=l(-1),c=l(-1),y=l(!1),_=l(null),b=l(!1),x=l(!1),f=l([]),D=l(null),g=l(null),w=N(()=>a.value.slice().sort((e,t)=>e.index-t.index));M(async()=>{await I()});async function I(){try{const e=await S.get(`${h}/banners/`);a.value=e.data.map((t,r)=>({...t,id:t.id??Date.now()+Math.random(),index:t.index??r,src:t.img_identifier,title:t.title??"Sin título"}))}catch(e){console.error("Error al obtener banners:",e)}}async function B(e){return(await S.post(`${h}/banners/`,e)).data}async function $(e){return(await S.post(`${h}/banners/reorder`,e)).data}async function G(e){return(await S.delete(`${h}/banners/${e}`)).data}function H(e){s.value=e}function W(e){c.value=e}function J(){c.value=-1}async function K(e){if(e===s.value)return;const t=w.value[s.value],r=a.value.findIndex(i=>i.id===t.id);a.value.splice(r,1),a.value.splice(e,0,t),a.value.forEach((i,u)=>{i.index=u}),s.value=-1,c.value=-1;try{const i=a.value.map(u=>({id:u.id,index:u.index,img_identifier:u.src}));await $(i)}catch(i){console.error("Error al reordenar banners:",i)}}function Q(e){_.value=e,y.value=!0}function R(){y.value=!1,_.value=null}async function Y(){if(_.value){try{await G(_.value.id);const e=a.value.findIndex(t=>t.id===_.value.id);e!==-1&&(a.value.splice(e,1),a.value.forEach((t,r)=>{t.index=r}))}catch(e){console.error("Error al eliminar banner:",e)}R()}}function Z(){b.value=!0}function ee(){g.value.click()}function te(e){const t=e.target.files;!t||t.length===0||(f.value=Array.from(t),f.value.length>0&&(D.value=URL.createObjectURL(f.value[0])),e.target.value="")}async function ae(){if(f.value.length===0){alert("Por favor selecciona al menos una imagen.");return}x.value=!0;try{for(const e of f.value){const t=new FormData;t.append("file",e);const r=await ie.uploadPhoto(t),{image_identifier:i}=r,u={index:a.value.length,img_identifier:i},o=await B(u);a.value.push({id:o.id??Date.now()+Math.random(),index:o.index??a.value.length-1,src:o.img_identifier,title:e.name})}f.value=[],D.value=null,b.value=!1}catch(e){console.error("Error al subir las imágenes o crear banners:",e),alert("Hubo un error al subir las imágenes.")}finally{x.value=!1}}return(e,t)=>{const r=E("Button"),i=E("ProgressSpinner"),u=E("Dialog");return v(),m(P,null,[d(ge),n("div",me,[_e,d(r,{style:{margin:"1rem 0","background-color":"var(--primary-color)",border:"none"},label:"Agregar Imágenes",icon:"pi pi-upload",onClick:Z}),d(u,{header:"Agregar Imágenes",visible:b.value,"onUpdate:visible":t[0]||(t[0]=o=>b.value=o),modal:"",style:{width:"40rem"}},{footer:k(()=>[n("div",xe,[d(r,{onClick:ae,severity:"success",label:"Guardar"})])]),default:k(()=>[n("div",he,[D.value?(v(),m("img",{key:0,src:D.value,alt:"Preview",style:{width:"100%","aspect-ratio":"19 / 9","background-color":"rgb(255, 255, 255)","object-fit":"cover","border-radius":"0.2rem"}},null,8,ye)):A("",!0),x.value?(v(),m("div",be,[d(i,{strokeWidth:"8",style:{color:"white"}})])):A("",!0),d(r,{class:"my-3",severity:"help",onClick:ee},{default:k(()=>[oe("Agregar foto")]),_:1}),n("input",{type:"file",ref_key:"fileInput",ref:g,onChange:te,style:{display:"none"},multiple:"",accept:"image/*"},null,544)])]),_:1},8,["visible"]),n("div",De,[(v(!0),m(P,null,T(w.value,(o,C)=>(v(),m("div",{key:o.id,class:le(["draggable-item",{"drag-over":c.value===C}]),draggable:"true",onDragstart:U=>H(C),onDragenter:F(U=>W(C),["prevent"]),onDragover:t[1]||(t[1]=F(()=>{},["prevent"])),onDragleave:J,onDrop:U=>K(C)},[n("img",{src:`${V(h)}/read-photo-product/${o.src}`,alt:o.title},null,8,ke),d(r,{style:{"border-radius":"50%",position:"absolute","background-color":"var(--primary-color)",border:"3px solid","aspect-ratio":"1 / 1",right:"-1.5rem",top:"-1.5rem"},icon:"pi pi-times",severity:"info",class:"delete-button",onClick:F(U=>Q(o),["stop"])},null,8,["onClick"])],42,Ie))),128)),d(u,{header:"Confirmar Eliminación",visible:y.value,"onUpdate:visible":t[2]||(t[2]=o=>y.value=o),modal:"",closable:!1,style:{width:"350px"}},{default:k(()=>[we,n("div",Be,[d(r,{label:"Sí, eliminar",icon:"pi pi-check",class:"p-button-danger",onClick:Y}),d(r,{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:R})])]),_:1},8,["visible"])])])],64)}}},Ue=L($e,[["__scopeId","data-v-e24c84a5"]]);export{Ue as default};
